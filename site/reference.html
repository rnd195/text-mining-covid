
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Reference - Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#article-scraper" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="how-to-guide.html" class="md-nav__link">
        How-To Guides
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="reference.html" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#article-scraper" class="md-nav__link">
    Article scraper
  </a>
  
    <nav class="md-nav" aria-label="Article scraper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper" class="md-nav__link">
    tmc.tmc_utils.article_scraper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.add_content" class="md-nav__link">
    add_content()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.generate_article_df" class="md-nav__link">
    generate_article_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.soup_object_request_all" class="md-nav__link">
    soup_object_request_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.soup_object_tor" class="md-nav__link">
    soup_object_tor()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-visualization-tools" class="md-nav__link">
    Data visualization tools
  </a>
  
    <nav class="md-nav" aria-label="Data visualization tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools" class="md-nav__link">
    tmc.data_viz_tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.basic_wordcloud" class="md-nav__link">
    basic_wordcloud()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.create_all_words" class="md-nav__link">
    create_all_words()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.create_hourly_df" class="md-nav__link">
    create_hourly_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.hourly_words_barplot" class="md-nav__link">
    hourly_words_barplot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dymamic-join" class="md-nav__link">
    Dymamic join
  </a>
  
    <nav class="md-nav" aria-label="Dymamic join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join" class="md-nav__link">
    tmc.dynamic_join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join.csv_to_df" class="md-nav__link">
    csv_to_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join.str_to_list" class="md-nav__link">
    str_to_list()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-data" class="md-nav__link">
    Get data
  </a>
  
    <nav class="md-nav" aria-label="Get data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.get_data" class="md-nav__link">
    tmc.get_data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-cleaner" class="md-nav__link">
    Text cleaner
  </a>
  
    <nav class="md-nav" aria-label="Text cleaner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.clean_text" class="md-nav__link">
    tmc.tmc_utils.clean_text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.clean_text.sentence_cleaner_cz" class="md-nav__link">
    sentence_cleaner_cz()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tor-initialization" class="md-nav__link">
    TOR initialization
  </a>
  
    <nav class="md-nav" aria-label="TOR initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization" class="md-nav__link">
    tmc.tmc_utils.tor_initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.get_tor_session" class="md-nav__link">
    get_tor_session()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.initiate_tor" class="md-nav__link">
    initiate_tor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.kill_tor_process" class="md-nav__link">
    kill_tor_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.tor_available" class="md-nav__link">
    tor_available()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#article-scraper" class="md-nav__link">
    Article scraper
  </a>
  
    <nav class="md-nav" aria-label="Article scraper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper" class="md-nav__link">
    tmc.tmc_utils.article_scraper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.add_content" class="md-nav__link">
    add_content()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.generate_article_df" class="md-nav__link">
    generate_article_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.soup_object_request_all" class="md-nav__link">
    soup_object_request_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.article_scraper.soup_object_tor" class="md-nav__link">
    soup_object_tor()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-visualization-tools" class="md-nav__link">
    Data visualization tools
  </a>
  
    <nav class="md-nav" aria-label="Data visualization tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools" class="md-nav__link">
    tmc.data_viz_tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.basic_wordcloud" class="md-nav__link">
    basic_wordcloud()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.create_all_words" class="md-nav__link">
    create_all_words()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.create_hourly_df" class="md-nav__link">
    create_hourly_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.data_viz_tools.hourly_words_barplot" class="md-nav__link">
    hourly_words_barplot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dymamic-join" class="md-nav__link">
    Dymamic join
  </a>
  
    <nav class="md-nav" aria-label="Dymamic join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join" class="md-nav__link">
    tmc.dynamic_join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join.csv_to_df" class="md-nav__link">
    csv_to_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.dynamic_join.str_to_list" class="md-nav__link">
    str_to_list()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-data" class="md-nav__link">
    Get data
  </a>
  
    <nav class="md-nav" aria-label="Get data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.get_data" class="md-nav__link">
    tmc.get_data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-cleaner" class="md-nav__link">
    Text cleaner
  </a>
  
    <nav class="md-nav" aria-label="Text cleaner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.clean_text" class="md-nav__link">
    tmc.tmc_utils.clean_text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.clean_text.sentence_cleaner_cz" class="md-nav__link">
    sentence_cleaner_cz()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tor-initialization" class="md-nav__link">
    TOR initialization
  </a>
  
    <nav class="md-nav" aria-label="TOR initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization" class="md-nav__link">
    tmc.tmc_utils.tor_initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.get_tor_session" class="md-nav__link">
    get_tor_session()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.initiate_tor" class="md-nav__link">
    initiate_tor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.kill_tor_process" class="md-nav__link">
    kill_tor_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmc.tmc_utils.tor_initialization.tor_available" class="md-nav__link">
    tor_available()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reference</h1>

<p>This webpage includes docstrings for all the major functions used in the project.</p>
<h2 id="article-scraper">Article scraper</h2>


<div class="doc doc-object doc-module">


<a id="tmc.tmc_utils.article_scraper"></a>
  <div class="doc doc-contents first">
  
      <p>Generate a dataframe with article properties.</p>
<p>Produces a dataframe with article details such as title, date, or link. Any
meaningful text is pre-processed using the <code>clean_text</code> module. Note that it
is tailored to a specific HTML structure of idnes.cz.</p>
<p>The module contains the following functions:</p>
<ul>
<li><code>soup_object_tor(link, tor_request_obj)</code> - Parses a TOR request</li>
<li><code>soup_object_request_all(link, tor_request_obj=None)</code> - Requests Archive.org before TOR or Google Webcache</li>
<li><code>generate_article_df(soup_object)</code> - Generates a dataframe of article properties</li>
<li><code>add_content(article_df, tor_requests_obj, sleeping=(10, 15))</code> - Adds content
   and other attributes to the df from the function <code>generate_article_df</code></li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.article_scraper.add_content" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_content</span><span class="p">(</span><span class="n">article_df</span><span class="p">,</span> <span class="n">tor_requests_obj</span><span class="p">,</span> <span class="n">sleeping</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add content to the article dataframe generated by <code>generate_article_df</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>article_df</code></td>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe with article properties</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tor_requests_obj</code></td>
          <td>
                <code>requests.<span title="requests.sessions">sessions</span>.<span title="requests.sessions.Session">Session</span></code>
          </td>
          <td><p>TOR requests object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sleeping</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Sleep time inbetween requests, defaults to (10, 15)</p></td>
          <td>
                <code>(10, 15)</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe with article properties and other content</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\article_scraper.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_content</span><span class="p">(</span><span class="n">article_df</span><span class="p">,</span> <span class="n">tor_requests_obj</span><span class="p">,</span> <span class="n">sleeping</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Add content to the article dataframe generated by `generate_article_df`</span>

<span class="sd">    Args:</span>
<span class="sd">        article_df (pandas.core.frame.DataFrame): Dataframe with article properties</span>
<span class="sd">        tor_requests_obj (requests.sessions.Session): TOR requests object</span>
<span class="sd">        sleeping (tuple, optional): Sleep time inbetween requests, defaults to (10, 15)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.core.frame.DataFrame): Dataframe with article properties and other content</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_article_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;perex_full&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;word_counter&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;authors_hash&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;topics&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">article_df</span><span class="o">.</span><span class="n">link</span><span class="p">):</span>
        <span class="c1"># Provide simple progress bar</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing page </span><span class="si">{</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">article_df</span><span class="o">.</span><span class="n">link</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Estimated time left for the current list: </span><span class="si">{</span><span class="n">sleeping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">article_df</span><span class="o">.</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">s&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">article_df</span><span class="o">.</span><span class="n">premium</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">article_df</span><span class="o">.</span><span class="n">gallery</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">article_df</span><span class="o">.</span><span class="n">video</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;perex_full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;word_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;authors_hash&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Premium, gallery, or video article detected. Skipping.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Request and parse</span>
        <span class="n">soup_page</span> <span class="o">=</span> <span class="n">soup_object_request_all</span><span class="p">(</span><span class="s2">&quot;https://www.idnes.cz&quot;</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">tor_requests_obj</span><span class="p">)</span>
        <span class="c1"># Give the page some breathing room</span>
        <span class="n">sleep</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">uniform</span><span class="p">(</span><span class="n">sleeping</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sleeping</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">3</span><span class="p">))</span>

        <span class="c1"># Save only cached websites in this step (a lot of requests), do not access directly</span>
        <span class="k">if</span> <span class="n">soup_page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tried Archive.org and Google Webcache, found nothing. Skipping.&quot;</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;perex_full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;word_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;authors_hash&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Full perex</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perex_full</span> <span class="o">=</span> <span class="n">sentence_cleaner_cz</span><span class="p">(</span>
                <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;opener&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
            <span class="p">)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;perex_full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perex_full</span><span class="p">)</span>
        <span class="c1"># Some subpages have a different name for the opening paragraph</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># In case an Attribute error persists, produce NA</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">perex_full</span> <span class="o">=</span> <span class="n">sentence_cleaner_cz</span><span class="p">(</span>
                    <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;excert&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
                <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;perex_full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perex_full</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;perex_full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>

        <span class="c1"># Content of the article as a Counter object</span>
        <span class="n">content_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">div_art_text</span> <span class="o">=</span> <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;art-text&quot;</span><span class="p">})</span>
        <span class="c1"># Some subpages use a different attribute for content</span>
        <span class="k">if</span> <span class="n">div_art_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">div_art_text</span> <span class="o">=</span> <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;content&quot;</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">div_art_text</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}):</span>
                <span class="n">content_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence_cleaner_cz</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># Unnest nested lists -&gt; convert iterable to list -&gt; apply Counter (50 most common words)</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;word_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">content_list</span><span class="p">)))</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;word_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Hashed author names</span>
            <span class="n">authors_div</span> <span class="o">=</span> <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;authors&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;itemprop&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="c1"># For our intents and purposes, we won&#39;t store names of the authors</span>
            <span class="c1"># Instead, we store hashes - unique ID for each author</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;authors_hash&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">authors_div</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="c1"># Some articles have no authors</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;authors_hash&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>

        <span class="c1"># Topics or tags of each article (lowercase)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">topics_div</span> <span class="o">=</span> <span class="n">soup_page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;art-tags&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">topics_div</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="c1"># In some cases, there are no tags</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">in_article_dict</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">article_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">in_article_dict</span><span class="p">)],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.article_scraper.generate_article_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_article_df</span><span class="p">(</span><span class="n">soup_object</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate a dataframe of article properties</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>soup_object</code></td>
          <td>
                <code>bs4.<span title="bs4.BeautifulSoup">BeautifulSoup</span></code>
          </td>
          <td><p>Parsed HTML document using BeautifulSoup</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe with article properties</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\article_scraper.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_article_df</span><span class="p">(</span><span class="n">soup_object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a dataframe of article properties</span>

<span class="sd">    Args:</span>
<span class="sd">        soup_object (bs4.BeautifulSoup): Parsed HTML document using BeautifulSoup</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.core.frame.DataFrame): Dataframe with article properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">soup_content</span> <span class="o">=</span> <span class="n">soup_object</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;list-art-count&quot;</span><span class="p">})</span>
    <span class="c1"># Initialize empty dictionary</span>
    <span class="n">article_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;perex_short&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;premium&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;video&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;gallery&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="c1"># Find and append links, dates, time, titles, perex, and premium access</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">soup_content</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;art&quot;</span><span class="p">}):</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;art-link&quot;</span><span class="p">},</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
        <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;https://www.idnes.cz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="n">date_and_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">})[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_and_time</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
        <span class="c1"># Articles with no specific time have 00:00:00 as the time of publication</span>
        <span class="k">if</span> <span class="n">date_and_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_and_time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;art-link&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;h3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">title_list</span> <span class="o">=</span> <span class="n">sentence_cleaner_cz</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title_list</span><span class="p">)</span>

        <span class="c1"># &#39;perex&#39; is the lead paragraph of each article (shortened here)</span>
        <span class="n">perex</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;perex&quot;</span><span class="p">})</span>
        <span class="c1"># Video articles don&#39;t have perex in the preview (e.g. around p. 203)</span>
        <span class="k">if</span> <span class="n">perex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;perex_short&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;premium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># It also gives us the ability to find whether it is a premium article</span>
        <span class="k">elif</span> <span class="n">perex</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;premlab&quot;</span><span class="p">})</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">perex_list</span> <span class="o">=</span> <span class="n">sentence_cleaner_cz</span><span class="p">(</span><span class="n">perex</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;perex_short&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perex_list</span><span class="p">)</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;premium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The word &quot;Premium&quot; is skipped</span>
            <span class="n">perex_list</span> <span class="o">=</span> <span class="n">sentence_cleaner_cz</span><span class="p">(</span><span class="n">perex</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;Premium&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;perex_short&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perex_list</span><span class="p">)</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;premium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Some articles are purely video-based</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;score-type&quot;</span><span class="p">:</span> <span class="s2">&quot;Video&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Some articles are just photo galleries</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;/foto&quot;</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;gallery&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">article_dict</span><span class="p">[</span><span class="s2">&quot;gallery&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">article_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.article_scraper.soup_object_request_all" class="doc doc-heading">
<code class="highlight language-python"><span class="n">soup_object_request_all</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">tor_request_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SKIP_CONSENT</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Request Archive.org before using TOR or Google Webcache and return a BeautifulSoup object</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Webpage URL</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tor_request_obj</code></td>
          <td>
                <code>requests.<span title="requests.sessions">sessions</span>.<span title="requests.sessions.Session">Session</span></code>
          </td>
          <td><p>TOR requests object</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>SKIP_CONSENT</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether or not to skip the prompt to</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bs4.<span title="bs4.BeautifulSoup">BeautifulSoup</span></code>
          </td>
          <td><p>Parsed HTML document using BeautifulSoup</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\article_scraper.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">soup_object_request_all</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">tor_request_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SKIP_CONSENT</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Request Archive.org before using TOR or Google Webcache and return a BeautifulSoup object</span>

<span class="sd">    Args:</span>
<span class="sd">        link (str): Webpage URL</span>
<span class="sd">        tor_request_obj (requests.sessions.Session): TOR requests object</span>
<span class="sd">        SKIP_CONSENT (bool): Whether or not to skip the prompt to</span>

<span class="sd">    Returns:</span>
<span class="sd">        (bs4.BeautifulSoup): Parsed HTML document using BeautifulSoup</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Use one of Archive.org&#39;s APIs to ask if the article is available, prefer TOR</span>
    <span class="n">archive_link</span> <span class="o">=</span> <span class="s2">&quot;http://archive.org/wayback/available?url=&quot;</span> <span class="o">+</span> <span class="n">link</span>
    <span class="k">if</span> <span class="n">tor_request_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">archive_json</span> <span class="o">=</span> <span class="n">tor_request_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_link</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">archive_json</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_link</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">archived</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">archive_json</span><span class="p">[</span><span class="s2">&quot;archived_snapshots&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="c1"># Continue if the website is available on Archive.org</span>
    <span class="k">if</span> <span class="n">archived</span> <span class="ow">and</span> <span class="n">archive_json</span><span class="p">[</span><span class="s2">&quot;archived_snapshots&quot;</span><span class="p">][</span><span class="s2">&quot;closest&quot;</span><span class="p">][</span><span class="s2">&quot;available&quot;</span><span class="p">]:</span>
        <span class="c1"># Use TOR to access Archive.org</span>
        <span class="k">if</span> <span class="n">tor_request_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found a snapshot on Archive.org. Using TOR to request the page.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">soup_object_tor</span><span class="p">(</span>
                <span class="n">archive_json</span><span class="p">[</span><span class="s2">&quot;archived_snapshots&quot;</span><span class="p">][</span><span class="s2">&quot;closest&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">tor_request_obj</span><span class="p">,</span>
                <span class="n">SKIP_CONSENT</span>
            <span class="p">)</span>
        <span class="c1"># Otherwise, fallback to no TOR</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_json</span><span class="p">[</span><span class="s2">&quot;archived_snapshots&quot;</span><span class="p">][</span><span class="s2">&quot;closest&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found a snapshot on Archive.org. Accessing directly.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

    <span class="c1"># Try Google Webcache with no TOR otherwise (TOR gets rate limited)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">archived</span> <span class="ow">and</span> <span class="n">tor_request_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;URL: </span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;could not be found on Archive.org. Accessing Google Webcache directly.&quot;</span>
        <span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://webcache.googleusercontent.com/search?q=cache:&quot;</span> <span class="o">+</span> <span class="n">link</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">)</span>
        <span class="c1"># In case of 404, return None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The website hasn&#39;t been cached or something else went wrong. Outputting None.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.article_scraper.soup_object_tor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">soup_object_tor</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">tor_request_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SKIP_CONSENT</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>"Send a request through TOR and parse it using BeautifulSoup</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Webpage URL</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tor_request_obj</code></td>
          <td>
                <code>requests.<span title="requests.sessions">sessions</span>.<span title="requests.sessions.Session">Session</span></code>
          </td>
          <td><p>TOR requests object</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>SKIP_CONSENT</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether or not to skip the prompt to</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bs4.<span title="bs4.BeautifulSoup">BeautifulSoup</span></code>
          </td>
          <td><p>Parsed HTML document using BeautifulSoup</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\article_scraper.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">soup_object_tor</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">tor_request_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SKIP_CONSENT</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;Send a request through TOR and parse it using BeautifulSoup</span>

<span class="sd">    Args:</span>
<span class="sd">        link (str): Webpage URL</span>
<span class="sd">        tor_request_obj (requests.sessions.Session): TOR requests object</span>
<span class="sd">        SKIP_CONSENT (bool): Whether or not to skip the prompt to</span>

<span class="sd">    Returns:</span>
<span class="sd">        (bs4.BeautifulSoup): Parsed HTML document using BeautifulSoup</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Give option to not route through TOR</span>
    <span class="k">if</span> <span class="n">tor_request_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TOR requests object hasn&#39;t been passed.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SKIP_CONSENT</span><span class="p">:</span>
            <span class="n">CONSENT</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Make requests without TOR? ([y]es / [n]o): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">CONSENT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input. Try again.&quot;</span><span class="p">)</span>
                <span class="n">CONSENT</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Make requests WITHOUT TOR? ([y]es / [n]o): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="c1"># If the user still wants to use TOR, exit this script</span>
            <span class="k">if</span> <span class="n">CONSENT</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pass a TOR requests object.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

    <span class="n">req</span> <span class="o">=</span> <span class="n">tor_request_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">link</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="data-visualization-tools">Data visualization tools</h2>


<div class="doc doc-object doc-module">


<a id="tmc.data_viz_tools"></a>
  <div class="doc doc-contents first">
  
      <p>Data visualization tools</p>
<p>This module works with the dataframe outputted by <code>dynamic_join.py</code>. It provides several data
visualization options, both static and interactive.</p>
<p>The module contains the following functions:</p>
<ul>
<li>create_all_words(df) - Concatenate Counter objects</li>
<li>basic_wordcloud(all_words_df, width=15, height=10) - Plot a simple wordcloud</li>
<li>create_hourly_df(df, words_to_delete) - Produce a long dataframe of hours / words / counts</li>
<li>hourly_words_barplot(df_hourly_words_long, y_range, width=1000, height=600) - Interactive barplot</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="tmc.data_viz_tools.basic_wordcloud" class="doc doc-heading">
<code class="highlight language-python"><span class="n">basic_wordcloud</span><span class="p">(</span><span class="n">all_words_df</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate a simple wordcloud using the <code>wordcloud</code> and <code>matplotlib</code> packages</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>all_words_df</code></td>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Output of <code>create_all_words()</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Figure width, defaults to 15</p></td>
          <td>
                <code>15</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Figure height, defaults to 10</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>A wordcloud plot</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\data_viz_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">basic_wordcloud</span><span class="p">(</span><span class="n">all_words_df</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a simple wordcloud using the `wordcloud` and `matplotlib` packages</span>

<span class="sd">    Args:</span>
<span class="sd">        all_words_df (pandas.core.frame.DataFrame): Output of `create_all_words()`</span>
<span class="sd">        width (int, optional): Figure width, defaults to 15</span>
<span class="sd">        height (int, optional): Figure height, defaults to 10</span>

<span class="sd">    Returns:</span>
<span class="sd">        A wordcloud plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">720</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">all_words_df</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.data_viz_tools.create_all_words" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_all_words</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">words_to_delete</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Join all Counter objects into one and delete specific words</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Output of <code>dynamic_join.py</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>words_to_delete</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List of words to delete</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>all_words</code></td>          <td>
                <code>collections.<span title="collections.Counter">Counter</span></code>
          </td>
          <td><p>Counter object of most frequent words</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\data_viz_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_all_words</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">words_to_delete</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Join all Counter objects into one and delete specific words</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.core.frame.DataFrame): Output of `dynamic_join.py`</span>
<span class="sd">        words_to_delete (list): List of words to delete</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_words (collections.Counter): Counter object of most frequent words</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_words</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">word_counter</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

    <span class="c1"># Delete a defined list of words</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words_to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_to_delete</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">all_words</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">all_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">all_words</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.data_viz_tools.create_hourly_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_hourly_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">words_to_delete</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a per-hour dataframe of top 10 words and their counts</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe of articles</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>words_to_delete</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List of words to be deleted (e.g. common words)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>df_hourly_words_long</code></td>          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Long dataframe of hours / words / counts</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\data_viz_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_hourly_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">words_to_delete</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a per-hour dataframe of top 10 words and their counts</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.core.frame.DataFrame): Dataframe of articles</span>
<span class="sd">        words_to_delete (list): List of words to be deleted (e.g. common words)</span>

<span class="sd">    Returns:</span>
<span class="sd">        df_hourly_words_long (pandas.core.frame.DataFrame): Long dataframe of hours / words / counts</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Join Counter objects for each hour from 6 to 20</span>
    <span class="n">list_hourly</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">word_counter</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">time_hour</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">df_hourly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_hourly</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;words&quot;</span><span class="p">])</span>

    <span class="c1"># Delete a defined list of words</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words_to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_to_delete</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">del</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">word</span><span class="p">]</span>

    <span class="c1"># Split the counter object into words and frequencies only</span>
    <span class="n">list_top_w</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_top_f</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">list_top_w</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">list_top_f</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

    <span class="n">df_hourly</span><span class="p">[</span><span class="s2">&quot;top_words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_top_w</span>
    <span class="n">df_hourly</span><span class="p">[</span><span class="s2">&quot;top_freqs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_top_f</span>

    <span class="c1"># Create a long dataset with individual hours, words, and counts as columns</span>
    <span class="n">list_hourly_words_long</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_hourly</span><span class="o">.</span><span class="n">hour</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_hourly</span><span class="o">.</span><span class="n">top_words</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">list_hourly_words_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">hour</span><span class="p">,</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">df_hourly</span><span class="o">.</span><span class="n">top_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="p">)</span>

    <span class="n">df_hourly_words_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">list_hourly_words_long</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df_hourly_words_long</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.data_viz_tools.hourly_words_barplot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hourly_words_barplot</span><span class="p">(</span><span class="n">df_hourly_words_long</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate an interactive barchart using <code>plotly</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df_hourly_words_long</code></td>
          <td>
                <code>pandas.<span title="pandas.core">core</span>.<span title="pandas.core.frame">frame</span>.<span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe produced by <code>create_hourly_df()</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_range</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Range of the y axis (frequency of words)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Figure width in pixels, defaults to 1000</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Figure height in pixelsm, defaults to 600</p></td>
          <td>
                <code>600</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Interactive barchart</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\data_viz_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hourly_words_barplot</span><span class="p">(</span><span class="n">df_hourly_words_long</span><span class="p">,</span> <span class="n">y_range</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate an interactive barchart using `plotly`</span>

<span class="sd">    Args:</span>
<span class="sd">        df_hourly_words_long (pandas.core.frame.DataFrame): Dataframe produced by `create_hourly_df()`</span>
<span class="sd">        y_range (list): Range of the y axis (frequency of words)</span>
<span class="sd">        width (int, optional): Figure width in pixels, defaults to 1000</span>
<span class="sd">        height (int, optional): Figure height in pixelsm, defaults to 600</span>

<span class="sd">    Returns:</span>
<span class="sd">        Interactive barchart</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">df_hourly_words_long</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span>
        <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Most frequent words per hour&quot;</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
        <span class="n">marker_line_color</span><span class="o">=</span><span class="s2">&quot;rgb(10, 45, 100)&quot;</span><span class="p">,</span>
        <span class="n">marker_line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;updatemenus&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="dymamic-join">Dymamic join</h2>


<div class="doc doc-object doc-module">


<a id="tmc.dynamic_join"></a>
  <div class="doc doc-contents first">
  
      <p>Splice .csv files into a dataframe</p>
<p>Produce a dataframe with correct data types from a set of <code>full_df</code> .csv files
generated by the <code>get_data.py</code> module.</p>
<p>The module contains the following functions:</p>
<ul>
<li><code>str_to_list(item)</code> - Converts a string of a list to a list</li>
<li><code>csv_to_df(CSV_PATH)</code> - Join .csv files into a dataframe</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="tmc.dynamic_join.csv_to_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">csv_to_df</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get all .csv files in the defined directory and return a dataframe</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>pandas.core.frame.DataFrame: Dataframe with correct data types</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\dynamic_join.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">csv_to_df</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get all .csv files in the defined directory and return a dataframe</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.core.frame.DataFrame: Dataframe with correct data types</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">csv_dir</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">)</span>
    <span class="n">csv_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">),</span> <span class="n">csv_dir</span><span class="p">))</span>

    <span class="c1"># Load first and append the rest</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">CSV_PATH</span> <span class="o">+</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">CSV_PATH</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">temp_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Manually set the type of the date column</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>

    <span class="c1"># Convert the time column into two integer cols: hours and minutes</span>
    <span class="n">time_hour</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
    <span class="n">time_min</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;time_hour&quot;</span><span class="p">,</span> <span class="n">time_hour</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;time_min&quot;</span><span class="p">,</span> <span class="n">time_min</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="c1"># Convert columns to lists and then process further if necessary</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;title&quot;</span><span class="p">,</span>
        <span class="s2">&quot;perex_short&quot;</span><span class="p">,</span>
        <span class="s2">&quot;perex_full&quot;</span><span class="p">,</span>
        <span class="s2">&quot;word_counter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;authors_hash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;topics&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">str_to_list</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;word_counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">word_counter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Counter</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.dynamic_join.str_to_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">str_to_list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert a string representation of a list to a list while handling NAs</p>

      <details class="quote">
        <summary>Source code in <code>tmc\dynamic_join.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">str_to_list</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a string representation of a list to a list while handling NAs&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="get-data">Get data</h2>


<div class="doc doc-object doc-module">


<a id="tmc.get_data"></a>
  <div class="doc doc-contents first">
  
      <p>Get article data</p>
<p>This script is used to obtain data article data from idnes.cz. First, a TOR
proxy is established, if possible. Then the user specifies the list start and
list end of the article list in question. The user is then informed about the
minimum amount of time the process will take (given that no rate limiting
takes place). Consent needs to be given in order to continue the script.
Finally, the script first collects the article lists and then processes public
articles as specified in <code>article_scraper.py</code>.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="text-cleaner">Text cleaner</h2>


<div class="doc doc-object doc-module">


<a id="tmc.tmc_utils.clean_text"></a>
  <div class="doc doc-contents first">
  
      <p>Procedures for pre-processing Czech text.</p>
<p>This module cleans Czech text following these steps: remove numbers, convert to
lowercase (except for names), remove punctuation, remove double spaces, remove
stopwords, tokenize, stem after lemmatization, and filter out 1 letter words.
Note that people usually choose either stemming or lemmatization in text
mining analyses. However, while the lemmatization tool that we use works very
well, on its own, it doesn't seem to recognize words such as "koronavirus,"
which is of paramount importance to our analysis. Thus, we unconventionally
apply both techniques.</p>
<p>The module contains the following functions:</p>
<ul>
<li><code>text_cleaner_cz(text_string)</code> - Cleans Czech text for text mining</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.clean_text.sentence_cleaner_cz" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sentence_cleaner_cz</span><span class="p">(</span><span class="n">text_string</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Pre-process Czech sentences for text mining</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text_string</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Text to be pre-processed</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>token_words_lm</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>List of lowercase words (no numbers, punctuation, or symbols)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\clean_text.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sentence_cleaner_cz</span><span class="p">(</span><span class="n">text_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pre-process Czech sentences for text mining</span>

<span class="sd">    Args:</span>
<span class="sd">        text_string (str): Text to be pre-processed</span>

<span class="sd">    Returns:</span>
<span class="sd">        token_words_lm (list): List of lowercase words (no numbers, punctuation, or symbols)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Download tokenizer and define stopwords</span>
    <span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;punkt&quot;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="n">get_stop_words</span><span class="p">(</span><span class="s2">&quot;czech&quot;</span><span class="p">)</span>
    <span class="n">punct_and_symbols</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span> <span class="o">+</span> <span class="s2">&quot;„“&quot;</span>

    <span class="c1"># Remove: numbers, symbols, punctuation, double whitespaces, stopwords</span>
    <span class="n">text_nonum</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text_string</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">text_nopunct</span> <span class="o">=</span> <span class="n">text_nonum</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
        <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">punct_and_symbols</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">text_nodbl</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; +&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text_nopunct</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">text_cleaned</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text_nodbl</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Tokenize words and sort alphabetically to break up any meaning</span>
    <span class="n">token_words</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">tokenize</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text_cleaned</span><span class="p">))</span>

    <span class="c1"># Use both lemmatization and stemming, see module description</span>
    <span class="n">token_words_lm</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">czech</span><span class="o">.</span><span class="n">stem_word</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;cs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">token_words</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">token_words_lm</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="tor-initialization">TOR initialization</h2>


<div class="doc doc-object doc-module">


<a id="tmc.tmc_utils.tor_initialization"></a>
  <div class="doc doc-contents first">
  
      <p>Initialize TOR for requests.</p>
<p>This module facilitates the usage of TOR for making requests.
Note that <code>tor.exe</code> needs to be installed and added in the user's PATH.</p>
<p>The module contains the following functions:</p>
<ul>
<li><code>tor_available()</code> - Checks if TOR is installed</li>
<li><code>get_tor_session()</code> - Prepares the SOCKS proxy for TOR</li>
<li><code>initiate_tor()</code> - Starts the tor.exe process in Windows</li>
<li><code>kill_tor_process()</code> - Terminates the tor.exe process in Windows</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.tor_initialization.get_tor_session" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_tor_session</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set up the SOCKS5 proxy for TOR</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>requests.<span title="requests.sessions">sessions</span>.<span title="requests.sessions.Session">Session</span></code>
          </td>
          <td><p>A session object with custom proxies</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\tor_initialization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tor_session</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set up the SOCKS5 proxy for TOR</span>

<span class="sd">    Returns:</span>
<span class="sd">        (requests.sessions.Session): A session object with custom proxies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="s2">&quot;socks5://127.0.0.1:9050&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https&quot;</span><span class="p">:</span> <span class="s2">&quot;socks5://127.0.0.1:9050&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">session</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.tor_initialization.initiate_tor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initiate_tor</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Starts the tor.exe process</p>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>SystemExit</code>
          </td>
          <td><p>Exits on non-Windows systems or when tor.exe isn't found</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>subprocess.<span title="subprocess.Popen">Popen</span></code>
          </td>
          <td><p>Starts the tor.exe process</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\tor_initialization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initiate_tor</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Starts the tor.exe process</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: Exits on non-Windows systems or when tor.exe isn&#39;t found</span>

<span class="sd">    Returns:</span>
<span class="sd">        (subprocess.Popen): Starts the tor.exe process</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tor_available</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span>

    <span class="c1"># Find the path of tor.exe</span>
    <span class="n">byte_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="s2">&quot;tor&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">tor_path</span> <span class="o">=</span> <span class="n">byte_path</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Start TOR process</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">9050</span>
    <span class="n">tor_process</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">launch_tor_with_config</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;SocksPort&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="n">init_msg_handler</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Bootstrapped&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tor_cmd</span><span class="o">=</span><span class="n">tor_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tor_process</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.tor_initialization.kill_tor_process" class="doc doc-heading">
<code class="highlight language-python"><span class="n">kill_tor_process</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Terminates the tor.exe process</p>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\tor_initialization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">kill_tor_process</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Terminates the tor.exe process&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
        <span class="c1"># Kill the executable ungracefully as tor_process.kill() did not work?</span>
        <span class="n">killmsg</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;taskkill&quot;</span><span class="p">,</span> <span class="s2">&quot;/im&quot;</span><span class="p">,</span> <span class="s2">&quot;tor.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;/F&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">killmsg</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
    <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to kill the TOR process.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tmc.tmc_utils.tor_initialization.tor_available" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tor_available</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if TOR is installed</p>

      <details class="quote">
        <summary>Source code in <code>tmc\tmc_utils\tor_initialization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tor_available</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check if TOR is installed&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
        <span class="c1"># Find the path of tor.exe</span>
        <span class="n">byte_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="s2">&quot;tor&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">tor_path</span> <span class="o">=</span> <span class="n">byte_path</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Check if tor.exe is installed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tor_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;The TOR executable could not be found.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Please, check if tor.exe is installed or added in PATH.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sorry, Windows 10/11 is needed to route requests through TOR.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="how-to-guide.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: How-To Guides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              How-To Guides
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>